#include QMK_KEYBOARD_H
#include <stdint.h>

#include <stdio.h>

enum Layers {
    _BASE   = 0,
    _BASE2  = 1,
    _LOWER  = 2,
    _RAISE  = 3,
    _ADJUST = 4,
    _DEVSYM = 5,
};

enum custom_keycodes {
    BASE = SAFE_RANGE,
    BASE2,
};

enum Encoder {
    _ENCODER_LEFT  = 0,
    _ENCODER_RIGHT = 1,
};

#define CTL_TAB MT(MOD_LCTL, KC_TAB)
#define LO_SPC LT(_LOWER, KC_SPC)
#define RS_ENT LT(_RAISE, KC_ENT)
#define SYM_L LT(_DEVSYM, KC_L)
#define SYM_S LT(_DEVSYM, KC_S)

// // Space cadet shift
// #define LSHIFT SC_LSPO
// #define RSHIFT SC_RSPC

// Normal shift
#define LSHIFT KC_LSFT
#define RSHIFT KC_RSFT

// clang-format off

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |    `    |    1    |    2    |    3    |    4    |    5    |         |         |         |    6    |    7    |    8    |    9    |    0    |  Caps   |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |    `    |    Q    |    W    |    E    |    R    |    T    |    [    |         |    ]    |    Y    |    U    |    I    |    O    |    P    |    \    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |   Esc   |    A    |    S    |    D    |    F    |    G    |    -    |         |    =    |    H    |    J    |    K    |    L    |    ;    |    '    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |  Shift  |    Z    |    X    |    C    |    V    |    B    |   Adj   |         |   Adj   |    N    |    M    |    ,    |    .    |    /    |  Shift  |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |  LOWER  |  Ctrl   |           |         |  RAISE  |         |         |
*                               |  Base   |   GUI   |  Space  |   Tab   |           | Backsp  |  Enter  |   Alt   |  Base2  |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_BASE] = LAYOUT( \
     KC_GRV     , KC_1      , KC_2      , KC_3      , KC_4      , KC_5      , KC_NO     ,                           KC_NO     , KC_6      , KC_7      , KC_8      , KC_9      , KC_0      , KC_CAPS   ,\
     KC_GRV     , KC_Q      , KC_W      , KC_E      , KC_R      , KC_T      , KC_LBRC   ,                           KC_RBRC   , KC_Y      , KC_U      , KC_I      , KC_O      , KC_P      , KC_BSLS   ,\
     KC_ESC     , KC_A      , SYM_S     , KC_D      , KC_F      , KC_G      , KC_MINS   ,                           KC_EQL    , KC_H      , KC_J      , KC_K      , SYM_L     , KC_SCLN   , KC_QUOT   ,\
     LSHIFT     , KC_Z      , KC_X      , KC_C      , KC_V      , KC_B      , _______   , TG(_ADJUST), TG(_ADJUST), _______   , KC_N      , KC_M      , KC_COMM   , KC_DOT    , KC_SLSH   , RSHIFT    ,\
                                          BASE      , KC_LGUI   , LO_SPC    , CTL_TAB   , KC_NO      , KC_NO      , KC_BSPC   , RS_ENT    , KC_RALT   , BASE2 \
  ),
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |    `    |    1    |    2    |    3    |    4    |    5    |         |         |         |    6    |    7    |    8    |    9    |    0    |  Caps   |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |   Tab   |    Q    |    W    |    E    |    R    |    T    |    [    |         |    ]    |    Y    |    U    |    I    |    O    |    P    |    \    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |   Esc   |    A    |    S    |    D    |    F    |    G    |    -    |         |    =    |    H    |    J    |    K    |    L    |    ;    |    '    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |  Shift  |    Z    |    X    |    C    |    V    |    B    |         |         |         |    N    |    M    |    ,    |    .    |    /    |  Shift  |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |  LOWER  |         |           |         |  RAISE  |         |         |
*                               |  Base   |   GUI   |         |  Space  |           |  Enter  |         |   Alt   |  Base2  |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_BASE2] = LAYOUT( \
     KC_GRV     , KC_1      , KC_2      , KC_3      , KC_4      , KC_5      , KC_NO     ,                           KC_NO     , KC_6      , KC_7      , KC_8      , KC_9      , KC_0      , KC_CAPS   ,\
     KC_TAB     , KC_Q      , KC_W      , KC_E      , KC_R      , KC_T      , KC_LBRC   ,                           KC_RBRC   , KC_Y      , KC_U      , KC_I      , KC_O      , KC_P      , KC_BSLS   ,\
     KC_ESC     , KC_A      , KC_S      , KC_D      , KC_F      , KC_G      , KC_MINS   ,                           KC_EQL    , KC_H      , KC_J      , KC_K      , KC_L      , KC_SCLN   , KC_QUOT   ,\
     LSHIFT     , KC_Z      , KC_X      , KC_C      , KC_V      , KC_B      , _______   , TG(_ADJUST), TG(_ADJUST), _______   , KC_N      , KC_M      , KC_COMM   , KC_DOT    , KC_SLSH   , RSHIFT   ,\
                                          BASE      , KC_LGUI   , MO(_LOWER), KC_SPC    , CTL_TAB    , KC_BSPC    , KC_ENT    , MO(_RAISE), KC_RALT   , BASE2 \
  ),
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |         |         |         |         |         |         |         |         |         |         |         |         |         |    *    |   Del   |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |  PgUp   |   Up    |  PgDn   |         |         |         |         |    :    |    7    |    8    |    9    |    +    |    *    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |  Home   |  Left   |  Down   |  Right  |   End   |         |         |         |    =    |    4    |    5    |    6    |    -    |    /    |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |         |         |         |         |         |         |         |    0    |    1    |    2    |    3    |    .    |    /    |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |         |         |           |         |  Space  |         |         |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_LOWER] = LAYOUT( \
    _______     , _______   , _______   , _______   , _______   , _______   , _______   ,                           _______   , _______   , _______   , _______   , _______   , KC_ASTR   , KC_DEL    ,\
    _______     , _______   , KC_PGUP   , KC_UP     , KC_PGDN   , _______   , _______   ,                           _______   , KC_COLN   , KC_7      , KC_8      , KC_9      , KC_PPLS   , KC_PAST   ,\
    _______     , KC_HOME   , KC_LEFT   , KC_DOWN   , KC_RIGHT  , KC_END    , _______   ,                           _______   , KC_EQL    , KC_4      , KC_5      , KC_6      , KC_PMNS   , KC_PSLS   ,\
    _______     , _______   , _______   , _______   , _______   , _______   , _______   , _______    , _______    , _______   , KC_0      , KC_1      , KC_2      , KC_3      , KC_DOT    , KC_SLSH   ,\
                                          _______   , _______   , _______   , _______   , _______    , _______    , _______   , _______   , KC_SPC    , _______ \
  ),
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |   F12   |   F1    |   F2    |   F3    |   F4    |   F5    |         |         |         |   F6    |   F7    |   F8    |   F9    |  F10    |   F11   |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |         |         |         |    +    |         |         |         |    :    |         |         |         |         |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |    <    |    (    |    {    |    [    |    -    |         |         |         |    =    |    ]    |    }    |    )    |    >    |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |         |         |         |    _    |         |         |         |  VolDn  |  VolUp  |  Prev   |  Next   |  Play   |  Mute   |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |         |         |           |   Del   |         |         |         |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_RAISE] = LAYOUT( \
    KC_F12      , KC_F1     , KC_F2     , KC_F3     , KC_F4     , KC_F5     , _______   ,                           _______   , KC_F6     , KC_F7     , KC_F8     , KC_F9     , KC_F10    , KC_F11    ,\
    _______     , _______   , _______   , _______   , _______   , KC_PLUS   , _______   ,                           _______   , KC_COLN   , _______   , _______   , _______   , _______   , _______   ,\
    _______     , KC_LT     , KC_LPRN   , KC_LCBR   , KC_LBRC   , KC_MINUS  , _______   ,                           _______   , KC_EQL    , KC_RBRC   , KC_RCBR   , KC_RPRN   , KC_GT     , _______   ,\
    _______     , _______   , _______   , _______   , _______   , KC_UNDS   , _______   , _______    , _______    , _______   , KC_VOLD   , KC_VOLU   , KC_MPRV   , KC_MNXT   , KC_MPLY   , KC_MUTE   ,\
                                          _______   , _______   , _______   , _______   , KC_DEL     , _______    , _______   , _______   , _______   , _______ \
  ),
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |  Sleep  |         |  ACL0   |  ACL1   |  ACL2   |         |  Reset  |         |  EE_CLR |         | RGB_TOG | RGB_M_SW|         |         | RGB_TOG |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |  BTN1   |  MS_U   |  BTN2   |  PSCR   |         |         |         |         | RGB_HUI | RGB_HUD | RGB_SAI | RGB_SAD |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |  MS_L   |  MS_D   |  MS_R   |         |         |         |         |         | RGB_MOD | RGB_RMOD| RGB_SPI | RGB_SPD |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |         |         |         |         |         |         |         |         |         |         | RGB_VAI | RGB_VAD |         |         |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |         |         |           |         |         |         |         |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_ADJUST] = LAYOUT( \
    KC_SLEP     , _______   , KC_ACL0   , KC_ACL1   , KC_ACL2   , _______   , Q_RESET   ,                           EE_CLR    , _______   , RGB_TOG   , RGB_M_SW  , _______   , _______   , RGB_TOG   ,\
    _______     , _______   , KC_BTN1   , KC_MS_U   , KC_BTN2   , KC_PSCR   , _______   ,                           _______   , _______   , RGB_HUI   , RGB_HUD   , RGB_SAI   , RGB_SAD   , _______   ,\
    _______     , _______   , KC_MS_L   , KC_MS_D   , KC_MS_R   , _______   , _______   ,                           _______   , _______   , RGB_MOD   , RGB_RMOD  , RGB_SPI   , RGB_SPD   , _______   ,\
    _______     , _______   , _______   , _______   , _______   , _______   , _______   , _______    , _______    , _______   , _______   , RGB_VAI   , RGB_VAD   , _______   , _______   , _______   ,\
                                          _______   , _______   , _______   , _______   , _______    , _______    , _______   , _______   , _______   , _______ \
  ),
/*
*  ,---------------------------------------------------------------------.         ,---------------------------------------------------------------------.
*  |         |         |         |         |         |         |         |         |         |         |         |         |         |         |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |    `    |    ~    |    #    |    &    |    |    |         |         |         |    ^    |    {    |    }    |    (    |    )    |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |    !    |    _    |    :    |    =    |    $    |         |         |         |    @    |    [    |    ]    |    _    |    ;    |         |
*  |---------------------------------------------------------------------|         |---------------------------------------------------------------------|
*  |         |    %    |    ?    |    *    |    +    |    \    |         |         |         |    /    |    -    |    <    |    >    |    "    |         |
*  `---------------------------------------------------------------------'         `---------------------------------------------------------------------'
*                               |         |         |         |         |           |         |         |         |         |
*                               `---------------------------------------'           `---------------------------------------'
*/
   [_DEVSYM] = LAYOUT( \
    _______     , _______   , _______   , _______   , _______   , _______   , _______   ,                           _______   , _______   , _______   , _______   , _______   , _______   , _______   ,\
    _______     , KC_GRV    , KC_TILD   , KC_HASH   , KC_AMPR   , KC_PIPE   , _______   ,                           _______   , KC_CIRC   , KC_LCBR   , KC_RCBR   , KC_LPRN   , KC_RPRN   , _______   ,\
    _______     , KC_EXLM   , KC_UNDS   , KC_COLN   , KC_EQL    , KC_DLR    , _______   ,                           _______   , KC_AT     , KC_LBRC   , KC_RBRC   , KC_UNDS   , KC_SCLN   , _______   ,\
    _______     , KC_PERC   , KC_QUES   , KC_ASTR   , KC_PLUS   , KC_BSLS   , _______   , _______    , _______    , _______   , KC_SLSH   , KC_MINS   , KC_LABK   , KC_RABK   , KC_DQUO   , _______   ,\
                                          _______   , _______   , _______   , _______   , _______    , _______    , _______   , _______   , _______   , _______ \
  ),
};

const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][2] = {
    [_BASE]   = { ENCODER_CCW_CW(KC_MPRV, KC_MNXT), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_BASE2]  = { ENCODER_CCW_CW(KC_MPRV, KC_MNXT), ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
    [_LOWER]  = { ENCODER_CCW_CW(RGB_HUI, RGB_HUD), ENCODER_CCW_CW(RGB_SAI, RGB_SAD) },
    [_RAISE]  = { ENCODER_CCW_CW(RGB_MOD, RGB_RMOD), ENCODER_CCW_CW(RGB_SPI, RGB_SPD) },
    [_ADJUST] = { ENCODER_CCW_CW(RGB_MOD, RGB_RMOD), ENCODER_CCW_CW(RGB_MOD, RGB_RMOD) },
    [_DEVSYM] = { ENCODER_CCW_CW(RGB_MOD, RGB_RMOD), ENCODER_CCW_CW(RGB_MOD, RGB_RMOD) },
};

// clang-format on

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case BASE:
            if (record->event.pressed) {
                set_single_persistent_default_layer(_BASE);
            }
            return false;
            break;
        case BASE2:
            if (record->event.pressed) {
                set_single_persistent_default_layer(_BASE2);
            }
            return false;
            break;
    }
    return true;
}
